{"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\Github Projects\\\\project-Eshan-Nayanapriya\\\\backend\\\\src\\\\tests\\\\security\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"D:\\\\Github Projects\\\\project-Eshan-Nayanapriya\\\\backend\",\"filename\":\"D:\\\\Github Projects\\\\project-Eshan-Nayanapriya\\\\backend\\\\src\\\\tests\\\\security\\\\security.test.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\Github Projects\\\\project-Eshan-Nayanapriya\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.9:development":{"value":{"code":"import request from \"supertest\";\nimport UserModel from \"../../models/user.model.js\";\nimport app from \"../../../index.js\";\nimport { expect } from \"chai\";\nimport User from \"../../../models/userModel\"; // Assuming this is your user model\n\ndescribe(\"Security Tests\", () => {\n  // Test: Unauthorized Access\n  it(\"should return 401 for unauthorized access\", async () => {\n    const res = await request(app).get(\"/api/auth/login\") // a protected route\n    .set(\"Authorization\", \"Bearer invalid_token\");\n    expect(res.status).to.equal(401); // Fixed the assertion method\n  });\n\n  // Test: Role-based Access Control (RBAC)\n  it(\"should return 403 for user without admin role trying to access admin route\", async () => {\n    const token = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY3YzkzNjNkZDIxZTJiMDRjZmJmYmM5YyIsInJvbGUiOiJ1c2VyIiwiaWF0IjoxNzQxNjY0NDQ2LCJleHAiOjE3NDE2NjgwNDZ9.N7CX5jNTrcS4ZVQmrzXCkgDgs_K76uTPFuuXW97j-P4\"; // actual token for a non-admin user\n    const res = await request(app).get(\"/api/users/admin\") // Replace with an actual admin route\n    .set(\"Authorization\", `Bearer ${token}`);\n    expect(res.status).to.equal(403); // Fixed the assertion method\n  });\n\n  // Test: NoSQL Injection\n  it(\"should reject NoSQL injection in user input\", async () => {\n    const maliciousInput = \"' OR 1=1 --\"; // Example of a NoSQL injection\n    const res = await request(app).post(\"/api/auth/login\").send({\n      username: maliciousInput,\n      password: \"password\"\n    });\n    expect(res.status).to.not.equal(200); // Should not allow login with malicious input (fixed assertion)\n  });\n\n  // Test: Password Hashing (Ensure password is hashed, not plain text)\n  it(\"should hash the password before storing\", async () => {\n    const user = {\n      username: \"testuser\",\n      password: \"plaintextpassword\"\n    };\n    const res = await request(app).post(\"/api/auth/register\").send(user);\n\n    // Check if password is hashed (bcrypt)\n    const savedUser = await UserModel.findOne({\n      username: user.username\n    }); // Corrected to query the User model\n    expect(savedUser.password).to.not.equal(user.password); // Password should be hashed (fixed assertion)\n  });\n\n  // Test: Rate Limiting\n  it(\"should limit the number of requests\", async () => {\n    // Simulate multiple requests\n    for (let i = 0; i < 10; i++) {\n      await request(app).post(\"/api/auth/login\").send({\n        username: \"testuser\",\n        password: \"password\"\n      });\n    }\n    const res = await request(app).post(\"/api/auth/login\").send({\n      username: \"testuser\",\n      password: \"password\"\n    });\n    expect(res.status).to.equal(429); // Expect rate-limiting response (too many requests) (fixed assertion)\n  });\n\n  // Test: Security Headers\n  it(\"should include necessary security headers\", async () => {\n    const res = await request(app).get(\"/\");\n    expect(res.headers[\"x-content-type-options\"]).to.equal(\"nosniff\");\n    expect(res.headers[\"x-frame-options\"]).to.equal(\"DENY\");\n    expect(res.headers[\"strict-transport-security\"]).to.equal(\"max-age=31536000; includeSubDomains\");\n  });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1ZXN0IiwiVXNlck1vZGVsIiwiYXBwIiwiZXhwZWN0IiwiVXNlciIsImRlc2NyaWJlIiwiaXQiLCJyZXMiLCJnZXQiLCJzZXQiLCJzdGF0dXMiLCJ0byIsImVxdWFsIiwidG9rZW4iLCJtYWxpY2lvdXNJbnB1dCIsInBvc3QiLCJzZW5kIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsIm5vdCIsInVzZXIiLCJzYXZlZFVzZXIiLCJmaW5kT25lIiwiaSIsImhlYWRlcnMiXSwic291cmNlUm9vdCI6IkQ6XFxHaXRodWIgUHJvamVjdHNcXHByb2plY3QtRXNoYW4tTmF5YW5hcHJpeWFcXGJhY2tlbmRcXHNyY1xcdGVzdHNcXHNlY3VyaXR5XFwiLCJzb3VyY2VzIjpbInNlY3VyaXR5LnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHJlcXVlc3QgZnJvbSBcInN1cGVydGVzdFwiO1xyXG5pbXBvcnQgVXNlck1vZGVsIGZyb20gXCIuLi8uLi9tb2RlbHMvdXNlci5tb2RlbC5qc1wiO1xyXG5pbXBvcnQgYXBwIGZyb20gXCIuLi8uLi8uLi9pbmRleC5qc1wiO1xyXG5pbXBvcnQgeyBleHBlY3QgfSBmcm9tIFwiY2hhaVwiO1xyXG5pbXBvcnQgVXNlciBmcm9tIFwiLi4vLi4vLi4vbW9kZWxzL3VzZXJNb2RlbFwiOyAvLyBBc3N1bWluZyB0aGlzIGlzIHlvdXIgdXNlciBtb2RlbFxyXG5cclxuZGVzY3JpYmUoXCJTZWN1cml0eSBUZXN0c1wiLCAoKSA9PiB7XHJcbiAgLy8gVGVzdDogVW5hdXRob3JpemVkIEFjY2Vzc1xyXG4gIGl0KFwic2hvdWxkIHJldHVybiA0MDEgZm9yIHVuYXV0aG9yaXplZCBhY2Nlc3NcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgIC5nZXQoXCIvYXBpL2F1dGgvbG9naW5cIikgLy8gYSBwcm90ZWN0ZWQgcm91dGVcclxuICAgICAgLnNldChcIkF1dGhvcml6YXRpb25cIiwgXCJCZWFyZXIgaW52YWxpZF90b2tlblwiKTtcclxuXHJcbiAgICBleHBlY3QocmVzLnN0YXR1cykudG8uZXF1YWwoNDAxKTsgLy8gRml4ZWQgdGhlIGFzc2VydGlvbiBtZXRob2RcclxuICB9KTtcclxuXHJcbiAgLy8gVGVzdDogUm9sZS1iYXNlZCBBY2Nlc3MgQ29udHJvbCAoUkJBQylcclxuICBpdChcInNob3VsZCByZXR1cm4gNDAzIGZvciB1c2VyIHdpdGhvdXQgYWRtaW4gcm9sZSB0cnlpbmcgdG8gYWNjZXNzIGFkbWluIHJvdXRlXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHRva2VuID0gXCJleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKcFpDSTZJalkzWXprek5qTmtaREl4WlRKaU1EUmpabUptWW1NNVl5SXNJbkp2YkdVaU9pSjFjMlZ5SWl3aWFXRjBJam94TnpReE5qWTBORFEyTENKbGVIQWlPakUzTkRFMk5qZ3dORFo5Lk43Q1g1ak5UcmNTNFpWUW1yelhDa2dEZ3NfSzc2dVRQRnV1WFc5N2otUDRcIjsgLy8gYWN0dWFsIHRva2VuIGZvciBhIG5vbi1hZG1pbiB1c2VyXHJcbiAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KGFwcClcclxuICAgICAgLmdldChcIi9hcGkvdXNlcnMvYWRtaW5cIikgLy8gUmVwbGFjZSB3aXRoIGFuIGFjdHVhbCBhZG1pbiByb3V0ZVxyXG4gICAgICAuc2V0KFwiQXV0aG9yaXphdGlvblwiLCBgQmVhcmVyICR7dG9rZW59YCk7XHJcblxyXG4gICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvLmVxdWFsKDQwMyk7IC8vIEZpeGVkIHRoZSBhc3NlcnRpb24gbWV0aG9kXHJcbiAgfSk7XHJcblxyXG4gIC8vIFRlc3Q6IE5vU1FMIEluamVjdGlvblxyXG4gIGl0KFwic2hvdWxkIHJlamVjdCBOb1NRTCBpbmplY3Rpb24gaW4gdXNlciBpbnB1dFwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCBtYWxpY2lvdXNJbnB1dCA9IFwiJyBPUiAxPTEgLS1cIjsgLy8gRXhhbXBsZSBvZiBhIE5vU1FMIGluamVjdGlvblxyXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgIC5wb3N0KFwiL2FwaS9hdXRoL2xvZ2luXCIpXHJcbiAgICAgIC5zZW5kKHsgdXNlcm5hbWU6IG1hbGljaW91c0lucHV0LCBwYXNzd29yZDogXCJwYXNzd29yZFwiIH0pO1xyXG5cclxuICAgIGV4cGVjdChyZXMuc3RhdHVzKS50by5ub3QuZXF1YWwoMjAwKTsgLy8gU2hvdWxkIG5vdCBhbGxvdyBsb2dpbiB3aXRoIG1hbGljaW91cyBpbnB1dCAoZml4ZWQgYXNzZXJ0aW9uKVxyXG4gIH0pO1xyXG5cclxuICAvLyBUZXN0OiBQYXNzd29yZCBIYXNoaW5nIChFbnN1cmUgcGFzc3dvcmQgaXMgaGFzaGVkLCBub3QgcGxhaW4gdGV4dClcclxuICBpdChcInNob3VsZCBoYXNoIHRoZSBwYXNzd29yZCBiZWZvcmUgc3RvcmluZ1wiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCB1c2VyID0geyB1c2VybmFtZTogXCJ0ZXN0dXNlclwiLCBwYXNzd29yZDogXCJwbGFpbnRleHRwYXNzd29yZFwiIH07XHJcbiAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KGFwcClcclxuICAgICAgLnBvc3QoXCIvYXBpL2F1dGgvcmVnaXN0ZXJcIilcclxuICAgICAgLnNlbmQodXNlcik7XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgcGFzc3dvcmQgaXMgaGFzaGVkIChiY3J5cHQpXHJcbiAgICBjb25zdCBzYXZlZFVzZXIgPSBhd2FpdCBVc2VyTW9kZWwuZmluZE9uZSh7IHVzZXJuYW1lOiB1c2VyLnVzZXJuYW1lIH0pOyAvLyBDb3JyZWN0ZWQgdG8gcXVlcnkgdGhlIFVzZXIgbW9kZWxcclxuICAgIGV4cGVjdChzYXZlZFVzZXIucGFzc3dvcmQpLnRvLm5vdC5lcXVhbCh1c2VyLnBhc3N3b3JkKTsgLy8gUGFzc3dvcmQgc2hvdWxkIGJlIGhhc2hlZCAoZml4ZWQgYXNzZXJ0aW9uKVxyXG4gIH0pO1xyXG5cclxuICAvLyBUZXN0OiBSYXRlIExpbWl0aW5nXHJcbiAgaXQoXCJzaG91bGQgbGltaXQgdGhlIG51bWJlciBvZiByZXF1ZXN0c1wiLCBhc3luYyAoKSA9PiB7XHJcbiAgICAvLyBTaW11bGF0ZSBtdWx0aXBsZSByZXF1ZXN0c1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XHJcbiAgICAgIGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAgIC5wb3N0KFwiL2FwaS9hdXRoL2xvZ2luXCIpXHJcbiAgICAgICAgLnNlbmQoeyB1c2VybmFtZTogXCJ0ZXN0dXNlclwiLCBwYXNzd29yZDogXCJwYXNzd29yZFwiIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAucG9zdChcIi9hcGkvYXV0aC9sb2dpblwiKVxyXG4gICAgICAuc2VuZCh7IHVzZXJuYW1lOiBcInRlc3R1c2VyXCIsIHBhc3N3b3JkOiBcInBhc3N3b3JkXCIgfSk7XHJcblxyXG4gICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvLmVxdWFsKDQyOSk7IC8vIEV4cGVjdCByYXRlLWxpbWl0aW5nIHJlc3BvbnNlICh0b28gbWFueSByZXF1ZXN0cykgKGZpeGVkIGFzc2VydGlvbilcclxuICB9KTtcclxuXHJcbiAgLy8gVGVzdDogU2VjdXJpdHkgSGVhZGVyc1xyXG4gIGl0KFwic2hvdWxkIGluY2x1ZGUgbmVjZXNzYXJ5IHNlY3VyaXR5IGhlYWRlcnNcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdChhcHApLmdldChcIi9cIik7XHJcblxyXG4gICAgZXhwZWN0KHJlcy5oZWFkZXJzW1wieC1jb250ZW50LXR5cGUtb3B0aW9uc1wiXSkudG8uZXF1YWwoXCJub3NuaWZmXCIpO1xyXG4gICAgZXhwZWN0KHJlcy5oZWFkZXJzW1wieC1mcmFtZS1vcHRpb25zXCJdKS50by5lcXVhbChcIkRFTllcIik7XHJcbiAgICBleHBlY3QocmVzLmhlYWRlcnNbXCJzdHJpY3QtdHJhbnNwb3J0LXNlY3VyaXR5XCJdKS50by5lcXVhbChcIm1heC1hZ2U9MzE1MzYwMDA7IGluY2x1ZGVTdWJEb21haW5zXCIpO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQSxPQUFPQSxPQUFPLE1BQU0sV0FBVztBQUMvQixPQUFPQyxTQUFTLE1BQU0sNEJBQTRCO0FBQ2xELE9BQU9DLEdBQUcsTUFBTSxtQkFBbUI7QUFDbkMsU0FBU0MsTUFBTSxRQUFRLE1BQU07QUFDN0IsT0FBT0MsSUFBSSxNQUFNLDJCQUEyQixDQUFDLENBQUM7O0FBRTlDQyxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsTUFBTTtFQUMvQjtFQUNBQyxFQUFFLENBQUMsMkNBQTJDLEVBQUUsWUFBWTtJQUMxRCxNQUFNQyxHQUFHLEdBQUcsTUFBTVAsT0FBTyxDQUFDRSxHQUFHLENBQUMsQ0FDM0JNLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0lBQUEsQ0FDdkJDLEdBQUcsQ0FBQyxlQUFlLEVBQUUsc0JBQXNCLENBQUM7SUFFL0NOLE1BQU0sQ0FBQ0ksR0FBRyxDQUFDRyxNQUFNLENBQUMsQ0FBQ0MsRUFBRSxDQUFDQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztFQUNwQyxDQUFDLENBQUM7O0VBRUY7RUFDQU4sRUFBRSxDQUFDLDRFQUE0RSxFQUFFLFlBQVk7SUFDM0YsTUFBTU8sS0FBSyxHQUFHLCtMQUErTCxDQUFDLENBQUM7SUFDL00sTUFBTU4sR0FBRyxHQUFHLE1BQU1QLE9BQU8sQ0FBQ0UsR0FBRyxDQUFDLENBQzNCTSxHQUFHLENBQUMsa0JBQWtCLENBQUMsQ0FBQztJQUFBLENBQ3hCQyxHQUFHLENBQUMsZUFBZSxFQUFFLFVBQVVJLEtBQUssRUFBRSxDQUFDO0lBRTFDVixNQUFNLENBQUNJLEdBQUcsQ0FBQ0csTUFBTSxDQUFDLENBQUNDLEVBQUUsQ0FBQ0MsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7RUFDcEMsQ0FBQyxDQUFDOztFQUVGO0VBQ0FOLEVBQUUsQ0FBQyw2Q0FBNkMsRUFBRSxZQUFZO0lBQzVELE1BQU1RLGNBQWMsR0FBRyxhQUFhLENBQUMsQ0FBQztJQUN0QyxNQUFNUCxHQUFHLEdBQUcsTUFBTVAsT0FBTyxDQUFDRSxHQUFHLENBQUMsQ0FDM0JhLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUN2QkMsSUFBSSxDQUFDO01BQUVDLFFBQVEsRUFBRUgsY0FBYztNQUFFSSxRQUFRLEVBQUU7SUFBVyxDQUFDLENBQUM7SUFFM0RmLE1BQU0sQ0FBQ0ksR0FBRyxDQUFDRyxNQUFNLENBQUMsQ0FBQ0MsRUFBRSxDQUFDUSxHQUFHLENBQUNQLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0VBQ3hDLENBQUMsQ0FBQzs7RUFFRjtFQUNBTixFQUFFLENBQUMseUNBQXlDLEVBQUUsWUFBWTtJQUN4RCxNQUFNYyxJQUFJLEdBQUc7TUFBRUgsUUFBUSxFQUFFLFVBQVU7TUFBRUMsUUFBUSxFQUFFO0lBQW9CLENBQUM7SUFDcEUsTUFBTVgsR0FBRyxHQUFHLE1BQU1QLE9BQU8sQ0FBQ0UsR0FBRyxDQUFDLENBQzNCYSxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FDMUJDLElBQUksQ0FBQ0ksSUFBSSxDQUFDOztJQUViO0lBQ0EsTUFBTUMsU0FBUyxHQUFHLE1BQU1wQixTQUFTLENBQUNxQixPQUFPLENBQUM7TUFBRUwsUUFBUSxFQUFFRyxJQUFJLENBQUNIO0lBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN4RWQsTUFBTSxDQUFDa0IsU0FBUyxDQUFDSCxRQUFRLENBQUMsQ0FBQ1AsRUFBRSxDQUFDUSxHQUFHLENBQUNQLEtBQUssQ0FBQ1EsSUFBSSxDQUFDRixRQUFRLENBQUMsQ0FBQyxDQUFDO0VBQzFELENBQUMsQ0FBQzs7RUFFRjtFQUNBWixFQUFFLENBQUMscUNBQXFDLEVBQUUsWUFBWTtJQUNwRDtJQUNBLEtBQUssSUFBSWlCLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBRyxFQUFFLEVBQUVBLENBQUMsRUFBRSxFQUFFO01BQzNCLE1BQU12QixPQUFPLENBQUNFLEdBQUcsQ0FBQyxDQUNmYSxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FDdkJDLElBQUksQ0FBQztRQUFFQyxRQUFRLEVBQUUsVUFBVTtRQUFFQyxRQUFRLEVBQUU7TUFBVyxDQUFDLENBQUM7SUFDekQ7SUFFQSxNQUFNWCxHQUFHLEdBQUcsTUFBTVAsT0FBTyxDQUFDRSxHQUFHLENBQUMsQ0FDM0JhLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUN2QkMsSUFBSSxDQUFDO01BQUVDLFFBQVEsRUFBRSxVQUFVO01BQUVDLFFBQVEsRUFBRTtJQUFXLENBQUMsQ0FBQztJQUV2RGYsTUFBTSxDQUFDSSxHQUFHLENBQUNHLE1BQU0sQ0FBQyxDQUFDQyxFQUFFLENBQUNDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0VBQ3BDLENBQUMsQ0FBQzs7RUFFRjtFQUNBTixFQUFFLENBQUMsMkNBQTJDLEVBQUUsWUFBWTtJQUMxRCxNQUFNQyxHQUFHLEdBQUcsTUFBTVAsT0FBTyxDQUFDRSxHQUFHLENBQUMsQ0FBQ00sR0FBRyxDQUFDLEdBQUcsQ0FBQztJQUV2Q0wsTUFBTSxDQUFDSSxHQUFHLENBQUNpQixPQUFPLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxDQUFDYixFQUFFLENBQUNDLEtBQUssQ0FBQyxTQUFTLENBQUM7SUFDakVULE1BQU0sQ0FBQ0ksR0FBRyxDQUFDaUIsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQ2IsRUFBRSxDQUFDQyxLQUFLLENBQUMsTUFBTSxDQUFDO0lBQ3ZEVCxNQUFNLENBQUNJLEdBQUcsQ0FBQ2lCLE9BQU8sQ0FBQywyQkFBMkIsQ0FBQyxDQUFDLENBQUNiLEVBQUUsQ0FBQ0MsS0FBSyxDQUFDLHFDQUFxQyxDQUFDO0VBQ2xHLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==","map":{"version":3,"names":["request","UserModel","app","expect","User","describe","it","res","get","set","status","to","equal","token","maliciousInput","post","send","username","password","not","user","savedUser","findOne","i","headers"],"sourceRoot":"D:\\Github Projects\\project-Eshan-Nayanapriya\\backend\\src\\tests\\security\\","sources":["security.test.js"],"sourcesContent":["import request from \"supertest\";\r\nimport UserModel from \"../../models/user.model.js\";\r\nimport app from \"../../../index.js\";\r\nimport { expect } from \"chai\";\r\nimport User from \"../../../models/userModel\"; // Assuming this is your user model\r\n\r\ndescribe(\"Security Tests\", () => {\r\n  // Test: Unauthorized Access\r\n  it(\"should return 401 for unauthorized access\", async () => {\r\n    const res = await request(app)\r\n      .get(\"/api/auth/login\") // a protected route\r\n      .set(\"Authorization\", \"Bearer invalid_token\");\r\n\r\n    expect(res.status).to.equal(401); // Fixed the assertion method\r\n  });\r\n\r\n  // Test: Role-based Access Control (RBAC)\r\n  it(\"should return 403 for user without admin role trying to access admin route\", async () => {\r\n    const token = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY3YzkzNjNkZDIxZTJiMDRjZmJmYmM5YyIsInJvbGUiOiJ1c2VyIiwiaWF0IjoxNzQxNjY0NDQ2LCJleHAiOjE3NDE2NjgwNDZ9.N7CX5jNTrcS4ZVQmrzXCkgDgs_K76uTPFuuXW97j-P4\"; // actual token for a non-admin user\r\n    const res = await request(app)\r\n      .get(\"/api/users/admin\") // Replace with an actual admin route\r\n      .set(\"Authorization\", `Bearer ${token}`);\r\n\r\n    expect(res.status).to.equal(403); // Fixed the assertion method\r\n  });\r\n\r\n  // Test: NoSQL Injection\r\n  it(\"should reject NoSQL injection in user input\", async () => {\r\n    const maliciousInput = \"' OR 1=1 --\"; // Example of a NoSQL injection\r\n    const res = await request(app)\r\n      .post(\"/api/auth/login\")\r\n      .send({ username: maliciousInput, password: \"password\" });\r\n\r\n    expect(res.status).to.not.equal(200); // Should not allow login with malicious input (fixed assertion)\r\n  });\r\n\r\n  // Test: Password Hashing (Ensure password is hashed, not plain text)\r\n  it(\"should hash the password before storing\", async () => {\r\n    const user = { username: \"testuser\", password: \"plaintextpassword\" };\r\n    const res = await request(app)\r\n      .post(\"/api/auth/register\")\r\n      .send(user);\r\n\r\n    // Check if password is hashed (bcrypt)\r\n    const savedUser = await UserModel.findOne({ username: user.username }); // Corrected to query the User model\r\n    expect(savedUser.password).to.not.equal(user.password); // Password should be hashed (fixed assertion)\r\n  });\r\n\r\n  // Test: Rate Limiting\r\n  it(\"should limit the number of requests\", async () => {\r\n    // Simulate multiple requests\r\n    for (let i = 0; i < 10; i++) {\r\n      await request(app)\r\n        .post(\"/api/auth/login\")\r\n        .send({ username: \"testuser\", password: \"password\" });\r\n    }\r\n\r\n    const res = await request(app)\r\n      .post(\"/api/auth/login\")\r\n      .send({ username: \"testuser\", password: \"password\" });\r\n\r\n    expect(res.status).to.equal(429); // Expect rate-limiting response (too many requests) (fixed assertion)\r\n  });\r\n\r\n  // Test: Security Headers\r\n  it(\"should include necessary security headers\", async () => {\r\n    const res = await request(app).get(\"/\");\r\n\r\n    expect(res.headers[\"x-content-type-options\"]).to.equal(\"nosniff\");\r\n    expect(res.headers[\"x-frame-options\"]).to.equal(\"DENY\");\r\n    expect(res.headers[\"strict-transport-security\"]).to.equal(\"max-age=31536000; includeSubDomains\");\r\n  });\r\n});\r\n"],"mappings":"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","ignoreList":[]}},"mtime":1741665128994}}